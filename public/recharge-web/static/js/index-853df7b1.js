import{L as e,I as a,P as s,B as l,C as t}from"./vant@4.0.2_vue@3.2.45-0f7d1012.js";import{d as o,M as u,S as n,_ as i}from"./supplier-12434f30.js";import{h as r}from"./index-9d169e54.js";import{a as c}from"./@vue_runtime-dom@3.2.45-cffd43d2.js";import{u as d}from"./vue-i18n@9.2.2_vue@3.2.45-dbb84d24.js";import{u as v}from"./vue-router@4.1.6_vue@3.2.45-08347e33.js";import{a as m}from"./axios@1.2.0-be54863b.js";import{I as p,n as y,o as f}from"./@vue_shared@3.2.45-800437f9.js";import{r as b,u as h}from"./@vue_reactivity@3.2.45-cfab916d.js";import{b as _,o as g,c as j,v as k,x as w,y as x,C as q,r as C,D as I,s as A,j as P,A as T}from"./@vue_runtime-core@3.2.45-3536ec1e.js";import"./@vant_use@1.4.3-cf798011.js";import"./index-91e2b5ed.js";import"./pinia@2.0.27_vue@3.2.45-169bf4d2.js";import"./vue-demi@0.13.11_vue@3.2.45-cc62bdbe.js";import"./@vant_touch-emulator@1.4.0-b69b1720.js";import"./@intlify_shared@9.2.2-d1f44ad0.js";import"./@intlify_core-base@9.2.2-0e6bfd90.js";import"./@intlify_message-compiler@9.2.2-f9606ba4.js";import"./@intlify_devtools-if@9.2.2-0bacd0ee.js";import"./form-data@4.0.0-d4e29958.js";const L={class:"number"},U={class:"title"},B={class:"assets"},E={class:"info",style:{flex:"1",display:"flex",height:"100%"}},O=["placeholder"],S={class:"symbol"},V=q("br",null,null,-1),F={class:"sub"},M={class:"title"},z={class:"assets"},D={class:"info"},G=["value","placeholder"],K={class:"moneyInfo"},N=["src"],$={class:"info"},H=["src"],J={key:1,class:"supplier"},Q={class:"empty"},R={__name:"index",setup(R){const{t:W}=d(),X=v();b(!1);const Y=b(!1),Z=b(/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream),ee=b(1==X.query.dark?"dark":"light"),ae=b([]),se=b(null),le=b(!1),te=b(!1),oe=b(X.query.defaultAmount||""),ue=b({}),ne=b(Object.keys(o).map((e=>({lable:e,icon:`https://ullafile.oss-cn-chengdu.aliyuncs.com/image/currency/${e}.png`,...o[e]})))),ie=e=>{const a=oe.value;if("del"!==e){if("."===e&&-1!=a.indexOf("."))return;if("0"===oe.value[0]&&"."!==oe.value[1]){if("0"===e)return;if("."!==e)return oe.value=a.slice(1,a.length),oe.value=oe.value+e,void me()}oe.value=a+e}else oe.value=a.slice(0,a.length-1),""===oe.value&&(oe.value="0");me()};_((()=>{oe.value&&me(),document.body.style.overflow="initial",ue.value=ne.value[0]})),g((()=>{document.body.style.overflow=""}));const re=j((()=>!oe.value||Y.value)),ce=e=>{ue.value=e,te.value=!1,me()},de=e=>{se.value=e,le.value=!1};let ve;const me=function(e,a){let s=null;return function(...l){s&&clearTimeout(s),s=setTimeout((()=>{e.apply(this,l)}),a)}}((()=>{(async()=>{ve&&ve();const e=m.CancelToken;Y.value=!0;try{const a={fiat2Token:!1,net:X.query.net,symbol:X.query.symbol,address:X.query.to,sourceFiatCurrency:ue.value.lable,sourceValue:oe.value},{code:s,data:l}=await r.get("/payEstimate/allChannelEstimateFee",a,{cancelToken:new e((function(e){ve=e}))});200==s&&l&&(se.value=l[0],ae.value=l)}catch(a){}Y.value=!1})()}),600),pe=async()=>{if(!(oe.value<=0)&&oe.value){Y.value=!0,setTimeout((()=>Y.value=!1),5e3);try{const e=se.value,{code:a,data:s}=await r.post("/order/add",{toAddress:"",fromAddress:X.query.form,deliverGoods:"0",...X.query,net:X.query.net,currency:ue.value.lable,to:X.query.to,symbol:X.query.symbol,channelIdent:e.channelIdent,businessId:X.query.businessId,businessUserId:X.query.businessUserId,type:"sell",channelId:e.channelId,tokenAmount:e.amount,conversionPrice:e.conversionPrice,inputValue:oe.value});200==a&&(window.location.href=s.url)}catch(e){}}};return(o,r)=>{const d=e,v=a,m=s,b=l,_=i,g=t;return k(),w(g,{theme:ee.value},{default:x((()=>[q("main",{class:y(["main",{ios:Z.value}]),style:f("--main-color: #"+(h(X).query.theme||"2EBC84"))},[q("div",L,[q("div",U,p(h(W)("startpay.sell")),1),q("label",B,[q("div",E,[C(q("input",{readonly:"",class:"num","onUpdate:modelValue":r[0]||(r[0]=e=>oe.value=e),is:"ui-input",inputmode:"decimal",placeholder:h(W)("startpay.sell")},null,8,O),[[c,oe.value]])]),q("div",S,[q("span",null,p(h(X).query.symbol),1),V,q("span",F,p(h(X).query.net),1)])])]),q("div",{class:"number",onClick:r[1]||(r[1]=e=>te.value=!0)},[q("div",M,p(h(W)("startpay.get")),1),q("div",z,[q("div",D,[q("input",{class:"num",readonly:"",value:se.value&&se.value.amount,placeholder:h(W)("startpay.get")},null,8,G)]),q("div",K,[Y.value?(k(),w(d,{key:0,size:"24",style:{"margin-right":"4px"}})):I("",!0),q("img",{src:ue.value.icon},null,8,N),A(p(ue.value.lable),1),P(v,{name:"arrow"})])])]),se.value?(k(),T("div",{key:0,class:"supplier",onClick:r[2]||(r[2]=e=>le.value=!0)},[q("div",$,[q("img",{src:se.value.channelIcon},null,8,H),q("span",null,p(se.value.channelName),1)]),P(v,{name:"arrow"})])):(k(),T("div",J,[q("span",Q,p(h(W)("startpay.supplier.empty")),1)])),P(m,{position:"bottom",style:{height:"90vh","border-radius":"10px 10px 0 0"},show:te.value,"onUpdate:show":r[4]||(r[4]=e=>te.value=e)},{default:x((()=>[P(u,{class:"popup",onBack:r[3]||(r[3]=e=>te.value=!1),tokenList:ne.value,onConfirm:ce},null,8,["tokenList"])])),_:1},8,["show"]),P(m,{position:"bottom",style:{height:"90vh","border-radius":"10px 10px 0 0"},show:le.value,"onUpdate:show":r[6]||(r[6]=e=>le.value=e)},{default:x((()=>[P(n,{class:"popup",onBack:r[5]||(r[5]=e=>le.value=!1),tokenList:ae.value,onConfirm:de},null,8,["tokenList"])])),_:1},8,["show"]),P(_,{onOnKsysChange:ie},{footer:x((()=>[P(b,{loading:Y.value,disabled:h(re),class:"next-button",onClick:pe},{default:x((()=>[A(p(h(W)("next")),1)])),_:1},8,["loading","disabled"])])),_:1})],6)])),_:1},8,["theme"])}}};export{R as default};
