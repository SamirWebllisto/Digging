import{s as e,I as a,L as n,P as t}from"./vant@4.0.2_vue@3.2.45-0f7d1012.js";import{d as s,_ as i,M as o,S as l}from"./supplier-12434f30.js";import{R as u,A as c,_ as r}from"./assets-a6663fd2.js";import{h as p}from"./index-9d169e54.js";import{c as m}from"./channel-c200ba5e.js";import{f as d,_ as h}from"./index-91e2b5ed.js";import{u as v,b as y}from"./vue-router@4.1.6_vue@3.2.45-08347e33.js";import{u as f}from"./vue-i18n@9.2.2_vue@3.2.45-dbb84d24.js";import{a as b}from"./axios@1.2.0-be54863b.js";import{r as g,g as w,u as V}from"./@vue_reactivity@3.2.45-cfab916d.js";import{c as k,b as I,o as x,v as _,A as j,C,x as S,D as E,j as L,y as N,s as T,E as P,G as q}from"./@vue_runtime-core@3.2.45-3536ec1e.js";import{I as U,n as W}from"./@vue_shared@3.2.45-800437f9.js";import"./@vue_runtime-dom@3.2.45-cffd43d2.js";import"./@vant_use@1.4.3-cf798011.js";import"./pinia@2.0.27_vue@3.2.45-169bf4d2.js";import"./vue-demi@0.13.11_vue@3.2.45-cc62bdbe.js";import"./@vant_touch-emulator@1.4.0-b69b1720.js";import"./@intlify_shared@9.2.2-d1f44ad0.js";import"./@intlify_core-base@9.2.2-0e6bfd90.js";import"./@intlify_message-compiler@9.2.2-f9606ba4.js";import"./@intlify_devtools-if@9.2.2-0bacd0ee.js";import"./form-data@4.0.0-d4e29958.js";const A=e=>(P("data-v-a44d058d"),e=e(),q(),e),D={class:"purchase-page"},M={class:"info-container"},B={class:"back-icon"},O={class:"select-item"},G={class:"label"},K={class:"infos"},R={class:"icon"},z=["src"],F={key:1,src:"https://ullafile.oss-cn-chengdu.aliyuncs.com/image/currency/URB.png"},J={class:"name"},$={key:0,class:"right"},H=["src"],Q={class:"select-item",style:{"margin-bottom":"30px"}},X={class:"label"},Y={class:"select"},Z={class:"infos"},ee={class:"icon",style:{position:"relative"}},ae=["src"],ne=["src"],te={class:"name MultipleLin"},se=A((()=>C("div",{class:"right"},null,-1))),ie=["src"],oe={class:"name"},le={key:1,class:"channel-opt"},ue=A((()=>C("img",{src:r,alt:""},null,-1))),ce={class:"name",style:{color:"#9A9A9A"}},re={key:1,class:W(["next-btn","disabled"])},pe=h({__name:"index3",setup(r){const h=g(!1),P=g(!1),q=g(!1);g([]);const A=g([]);g({});const pe=g({}),me=e=>{h.value=!1,he.value=e.acronym,je(e),ve.value=Ve.value.find((a=>a.acronym===e.acronym))},de=e=>{Ce(e),q.value=!1},he=g(),ve=g({}),ye=g([]),fe=g(null),be=e=>{P.value=!1,pe.value=e};I((async()=>{document.body.style.overflow="initial",he.value=ke.downValue,ve.value=Ve.value.find((e=>e.acronym===ke.downValue));const e=await p.post("/token/chainBaseToken",{},{baseURL:"https://app.ullapay.com/exchange"});ye.value=(e.data||[]).map((e=>e.tokens)).flat(),fe.value=ye.value.find((e=>e.net===ke.net&&e.symbol===ke.symbol))})),x((()=>{document.body.style.overflow=""}));const{t:ge,showLoading:we,downList:Ve,state:ke,unitShow:Ie,outGetInfo:xe,onKsysChange:_e,onDownChange:je,changeChannelIdent:Ce,onSwitch:Se,commInfo:Ee,allChannel:Le,commParams:Ne,accordWithPrc:Te,onGetInfo:Pe,onProcessParam:qe,routerSwitch:Ue,changeInpputValue:We,disabled:Ae,next:De,onBack:Me,route:Be}=function(){const a=v(),n=y(),t=g(!1),{t:i}=f(),o=k((()=>{const e=[];for(const a in s)e.push({lable:a,icon:`https://ullafile.oss-cn-chengdu.aliyuncs.com/image/currency/${a}.png`,...s[a]});return e})),l=w({net:a.query.net,symbol:a.query.symbol,switch:!0,inputValue:a.query.defaultAmount||"100",downValue:o.value[0].acronym,unitIcon:o.value[0].unit,unitName:o.value[0].name,rate:1,accordWithDis:!1,inputState:!1}),u=k((()=>l.switch?a.query.symbol:l.downValue)),c=function(e,a){let n=null;return function(...t){n&&clearTimeout(n),n=setTimeout((()=>{e.apply(this,t)}),a)}}((()=>{j()}),600),r=g({amount:0}),h=g([]),V=g({}),x=()=>{let a=0;return a=l.switch?d(l.inputValue/l.rate,6):r.value.price,r.value.buyEachTimeMin>a?(e(i("noAccordWithMin")+d(r.value.buyEachTimeMin*l.rate,2)+l.unitName),void(l.accordWithDis=!0)):r.value.buyEachTimeMax<a?(e(i("noAccordWithMax")+d(r.value.buyEachTimeMax*l.rate,2)+l.unitName),void(l.accordWithDis=!0)):void(l.accordWithDis=!1)};let _;const j=async e=>{_&&_();const n=b.CancelToken;try{let t="";t=e||(l.switch?d(l.inputValue/l.rate,6):l.inputValue);const s={fiat2Token:l.switch,net:l.net,symbol:l.symbol,address:a.query.to,sourceFiatCurrency:l.unitName,sourceValue:l.inputValue},{code:i,data:o}=await p.get("/payEstimate/allChannelEstimateFee",s,{cancelToken:new n((function(e){_=e}))});if(l.inputState=!1,200===i){if(!l.switch)for(let e=0;e<o.length;e++){const a=o[e];a.price=a.amount,a.amount=a.amount*l.rate}r.value={...o[0]||{}},h.value=[...o],V.value=s,x()}}catch(t){}};j();const C=()=>({net:l.net,value:V.value.value,currency:l.unitName,to:a.query.to,symbol:a.query.symbol,channelIdent:r.value.channelIdent,businessId:a.query.businessId,businessUserId:a.query.businessUserId,type:"buy",channelId:r.value.channelId,tokenAmount:r.value.amount,conversionPrice:r.value.conversionPrice,inputValue:l.switch?l.inputValue:r.value.amount,rate:l.rate,unit:u.value+l.unitIcon,legalUnit:l.downValue}),S=k((()=>0===Number(l.inputValue)||!!l.inputState||!!t.value||(-1!==String(l.inputValue).indexOf(".")?String(l.inputValue).split(".")[0].length>18||String(l.inputValue).split(".")[1].length>18:String(l.inputValue).length>18)));return I((()=>{localStorage.setItem("indexPath",window.location.href)})),{t:i,showLoading:t,downList:o,state:l,unitShow:u,outGetInfo:c,onKsysChange:e=>{l.inputState=!0;const a=String(l.inputValue);if(a){if("del"!==e){if("."===e&&-1!=a.indexOf("."))return;if("0"===l.inputValue[0]&&"."!==l.inputValue[1]){if("0"===e)return;if("."!==e)return l.inputValue=a.slice(1,a.length),l.inputValue=l.inputValue+e,void c()}l.inputValue=a+e}else l.inputValue=a.slice(0,a.length-1),""===l.inputValue&&(l.inputValue="0");c()}},onDownChange:e=>{l.rate=e.rate;let a=d(l.inputValue/e.rate,6);l.unitIcon=e.unit,l.unitName=e.name,j(a)},onSwitch:()=>{"0"!=l.inputValue&&(l.switch=!l.switch,V.value.fiat2Token=l.switch,l.inputValue=r.value.amount,j())},commInfo:r,allChannel:h,changeChannelIdent:e=>{r.value.channelIdent=e.channelIdent,r.value.channelName=e.channelName,r.value.channelIcon=e.channelIcon,r.value.amount=e.amount},commParams:V,accordWithPrc:x,onGetInfo:j,onProcessParam:C,routerSwitch:e=>{S.value||n.push({path:e,query:{params:JSON.stringify(V.value),next:JSON.stringify(C())}})},disabled:S,next:()=>{S.value||l.accordWithDis||(t.value=!0,setTimeout((()=>{t.value=!1}),5e3),m(r.value.channelIdent,C(),{baseURL:"https://8.ipemall.com/api/business"}))},onBack:(e="https://h5.iearnbot.com/pages/home/top-up/buy-coins")=>{window.location.href=e},route:a,changeInpputValue:e=>l.inputValue=e}}();return(e,s)=>{const r=a,p=n,m=i,d=t;return _(),j("div",D,[C("div",M,[C("div",B,["1"!==V(Be).query.businessId?(_(),S(r,{key:0,name:"arrow-left",size:"26",onClick:s[0]||(s[0]=e=>V(Me)())})):E("",!0)]),C("div",O,[C("label",G,U(V(ge)("startpay.pay")),1),C("div",{class:"select",onClick:s[1]||(s[1]=e=>h.value=!!V(ke).switch)},[C("span",{class:W(["amount",{hasValue:V(ke).inputValue>0}])},U(V(ke).inputValue),3),C("div",K,[C("div",R,[V(ke).switch?(_(),j("img",{key:0,src:ve.value.icon},null,8,z)):(_(),j("img",F))]),C("div",J,U(ve.value.name),1),V(ke).switch?(_(),j("div",$,[C("img",{src:V(u)},null,8,H)])):E("",!0)])])]),C("div",Q,[C("label",X,U(V(ge)("startpay.get")),1),C("div",Y,[C("span",{class:W(["amount",{hasValue:V(ke).inputValue>0}])},U(V(Ee).amount),3),C("div",Z,[C("div",ee,[fe.value?(_(),j("img",{key:0,src:fe.value.logoUrl},null,8,ae)):E("",!0),fe.value&&2===fe.value.coinType?(_(),j("img",{key:1,style:{position:"absolute","border-radius":"100%",right:"-5px",bottom:"0",width:"15px",height:"15px",border:"1px solid white"},src:fe.value.chainIcon},null,8,ne)):E("",!0)]),C("div",te,[C("span",null,U(V(Ie))+U(V(ke).switch?"":`(${V(ke).unitIcon})`),1),C("span",null,U(V(ke).net),1)]),se])])]),V(Ee).channelName?(_(),j("div",{key:0,class:"channel-opt",onClick:s[2]||(s[2]=e=>q.value=!0)},[C("img",{src:V(Ee).channelIcon,alt:""},null,8,ie),C("div",oe,U(V(Ee).channelName),1),L(r,{name:"arrow",size:"18"})])):(_(),j("div",le,[ue,C("div",ce,U(V(ge)("null")),1)]))]),L(m,{onOnKsysChange:V(_e)},{footer:N((()=>[V(Ee).channelName?(_(),j("div",{key:0,class:W(["next-btn",V(Ae)&&"disabled",V(ke).accordWithDis&&"disabled"]),onClick:s[3]||(s[3]=(...e)=>V(De)&&V(De)(...e))},[V(we)?(_(),S(p,{key:0,style:{"margin-right":"10px"},type:"spinner",size:"24px"})):E("",!0),T(" "+U(V(ge)("next")),1)],2)):(_(),j("div",re,U(V(ge)("next")),1))])),_:1},8,["onOnKsysChange"]),L(d,{position:"bottom",style:{height:"90vh","border-radius":"10px 10px 0 0","--van-popup-background":"#0E0E0E"},show:h.value,"onUpdate:show":s[5]||(s[5]=e=>h.value=e)},{default:N((()=>[L(o,{class:"popup",onBack:s[4]||(s[4]=e=>h.value=!1),tokenList:V(Ve),onConfirm:me},null,8,["tokenList"])])),_:1},8,["show"]),L(d,{position:"bottom",style:{height:"90vh","border-radius":"10px 10px 0 0","--van-popup-background":"#0E0E0E"},show:P.value,"onUpdate:show":s[7]||(s[7]=e=>P.value=e)},{default:N((()=>[L(c,{class:"popup",onBack:s[6]||(s[6]=e=>P.value=!1),tokenList:A.value,onConfirm:be},null,8,["tokenList"])])),_:1},8,["show"]),L(d,{position:"bottom",style:{height:"90vh","border-radius":"10px 10px 0 0","--van-popup-background":"#0E0E0E"},show:q.value,"onUpdate:show":s[9]||(s[9]=e=>q.value=e)},{default:N((()=>[L(l,{class:"popup",onBack:s[8]||(s[8]=e=>q.value=!1),tokenList:V(Le),onConfirm:de},null,8,["tokenList"])])),_:1},8,["show"])])}}},[["__scopeId","data-v-a44d058d"]]);export{pe as default};
