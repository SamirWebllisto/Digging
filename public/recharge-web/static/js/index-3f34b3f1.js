import{h as e}from"./index-9d169e54.js";import{d as t}from"./supplier-12434f30.js";import{c as n}from"./channel-c200ba5e.js";import{f as a}from"./index-91e2b5ed.js";import{u,b as i}from"./vue-router@4.1.6_vue@3.2.45-08347e33.js";import{u as o}from"./vue-i18n@9.2.2_vue@3.2.45-dbb84d24.js";import{a as l}from"./axios@1.2.0-be54863b.js";import{r,g as s}from"./@vue_reactivity@3.2.45-cfab916d.js";import{c,b as m}from"./@vue_runtime-core@3.2.45-3536ec1e.js";import{s as h}from"./vant@4.0.2_vue@3.2.45-0f7d1012.js";function p(){const p=u(),d=i(),v=r(!1),{t:f}=o(),y=c((()=>{const e=[];for(const n in t)e.push({lable:n,icon:`https://ullafile.oss-cn-chengdu.aliyuncs.com/image/currency/${n}.png`,...t[n]});return e})),V=s({net:p.query.net,symbol:p.query.symbol,switch:!0,inputValue:p.query.defaultAmount||"100",downValue:y.value[0].acronym,unitIcon:y.value[0].unit,unitName:y.value[0].name,rate:1,accordWithDis:!1,inputState:!1}),b=c((()=>V.switch?p.query.symbol:V.downValue));const g=function(e,t){let n=null;return function(...a){n&&clearTimeout(n),n=setTimeout((()=>{e.apply(this,a)}),t)}}((()=>{T()}),600),w=r({amount:0}),I=r([]),S=r({}),x=()=>{let e=0;return e=V.switch?a(V.inputValue/V.rate,6):w.value.price,w.value.buyEachTimeMin>e?(h(f("noAccordWithMin")+a(w.value.buyEachTimeMin*V.rate,2)+V.unitName),void(V.accordWithDis=!0)):w.value.buyEachTimeMax<e?(h(f("noAccordWithMax")+a(w.value.buyEachTimeMax*V.rate,2)+V.unitName),void(V.accordWithDis=!0)):void(V.accordWithDis=!1)};let N;const T=async t=>{N&&N();const n=l.CancelToken;try{let u="";u=t||(V.switch?a(V.inputValue/V.rate,6):V.inputValue);const i={fiat2Token:V.switch,net:V.net,symbol:V.symbol,address:p.query.to,sourceFiatCurrency:V.unitName,sourceValue:V.inputValue},{code:o,data:l}=await e.get("/payEstimate/allChannelEstimateFee",i,{cancelToken:new n((function(e){N=e}))});if(V.inputState=!1,200===o){if(!V.switch)for(let e=0;e<l.length;e++){const t=l[e];t.price=t.amount,t.amount=t.amount*V.rate}w.value={...l[0]||{}},I.value=[...l],S.value=i,x()}}catch(u){}};T();const j=()=>({net:V.net,value:S.value.value,currency:V.unitName,to:p.query.to,symbol:p.query.symbol,channelIdent:w.value.channelIdent,businessId:p.query.businessId,businessUserId:p.query.businessUserId,type:"buy",channelId:w.value.channelId,tokenAmount:w.value.amount,conversionPrice:w.value.conversionPrice,inputValue:V.switch?V.inputValue:w.value.amount,rate:V.rate,unit:b.value+V.unitIcon,legalUnit:V.downValue}),q=c((()=>0===Number(V.inputValue)||(!!V.inputState||(!!v.value||(-1!==String(V.inputValue).indexOf(".")?String(V.inputValue).split(".")[0].length>18||String(V.inputValue).split(".")[1].length>18:String(V.inputValue).length>18)))));m((()=>{localStorage.setItem("indexPath",window.location.href)}));return{t:f,showLoading:v,downList:y,state:V,unitShow:b,outGetInfo:g,onKsysChange:e=>{V.inputState=!0;const t=String(V.inputValue);if(t){if("del"!==e){if("."===e&&-1!=t.indexOf("."))return;if("0"===V.inputValue[0]&&"."!==V.inputValue[1]){if("0"===e)return;if("."!==e)return V.inputValue=t.slice(1,t.length),V.inputValue=V.inputValue+e,void g()}V.inputValue=t+e}else V.inputValue=t.slice(0,t.length-1),""===V.inputValue&&(V.inputValue="0");g()}},onDownChange:e=>{V.rate=e.rate;let t=a(V.inputValue/e.rate,6);V.unitIcon=e.unit,V.unitName=e.name,T(t)},onSwitch:()=>{"0"!=V.inputValue&&(V.switch=!V.switch,S.value.fiat2Token=V.switch,V.inputValue=w.value.amount,T())},commInfo:w,allChannel:I,changeChannelIdent:e=>{w.value.channelIdent=e.channelIdent,w.value.channelName=e.channelName,w.value.channelIcon=e.channelIcon,w.value.amount=e.amount},commParams:S,accordWithPrc:x,onGetInfo:T,onProcessParam:j,routerSwitch:e=>{q.value||d.push({path:e,query:{params:JSON.stringify(S.value),next:JSON.stringify(j())}})},disabled:q,next:()=>{q.value||V.accordWithDis||(v.value=!0,setTimeout((()=>{v.value=!1}),5e3),n(w.value.channelIdent,j()))},onBack:(e="https://h5.iearnbot.com/pages/home/top-up/buy-coins")=>{window.location.href=e},route:p,changeInpputValue:e=>V.inputValue=e}}export{p as u};
